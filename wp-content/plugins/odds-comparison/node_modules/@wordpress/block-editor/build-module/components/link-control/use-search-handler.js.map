{"version":3,"sources":["@wordpress/block-editor/src/components/link-control/use-search-handler.js"],"names":["getProtocol","prependHTTP","useCallback","useSelect","isURLLike","CREATE_TYPE","TEL_TYPE","MAILTO_TYPE","INTERNAL_TYPE","URL_TYPE","store","blockEditorStore","handleNoop","Promise","resolve","handleDirectEntry","val","type","protocol","includes","startsWith","id","title","url","handleEntitySearch","suggestionsQuery","fetchSearchSuggestions","withCreateSuggestion","pageOnFront","isInitialSuggestions","results","map","result","Number","isFrontPage","concat","useSearchHandler","allowDirectEntry","withURLSuggestion","select","getSettings","__experimentalFetchLinkSuggestions","directEntryHandler"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { getProtocol, prependHTTP } from '@wordpress/url';\nimport { useCallback } from '@wordpress/element';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport isURLLike from './is-url-like';\nimport {\n\tCREATE_TYPE,\n\tTEL_TYPE,\n\tMAILTO_TYPE,\n\tINTERNAL_TYPE,\n\tURL_TYPE,\n} from './constants';\nimport { store as blockEditorStore } from '../../store';\n\nexport const handleNoop = () => Promise.resolve( [] );\n\nexport const handleDirectEntry = ( val ) => {\n\tlet type = URL_TYPE;\n\n\tconst protocol = getProtocol( val ) || '';\n\n\tif ( protocol.includes( 'mailto' ) ) {\n\t\ttype = MAILTO_TYPE;\n\t}\n\n\tif ( protocol.includes( 'tel' ) ) {\n\t\ttype = TEL_TYPE;\n\t}\n\n\tif ( val?.startsWith( '#' ) ) {\n\t\ttype = INTERNAL_TYPE;\n\t}\n\n\treturn Promise.resolve( [\n\t\t{\n\t\t\tid: val,\n\t\t\ttitle: val,\n\t\t\turl: type === 'URL' ? prependHTTP( val ) : val,\n\t\t\ttype,\n\t\t},\n\t] );\n};\n\nconst handleEntitySearch = async (\n\tval,\n\tsuggestionsQuery,\n\tfetchSearchSuggestions,\n\twithCreateSuggestion,\n\tpageOnFront\n) => {\n\tconst { isInitialSuggestions } = suggestionsQuery;\n\n\tconst results = await fetchSearchSuggestions( val, suggestionsQuery );\n\n\t// Identify front page and update type to match.\n\tresults.map( ( result ) => {\n\t\tif ( Number( result.id ) === pageOnFront ) {\n\t\t\tresult.isFrontPage = true;\n\t\t\treturn result;\n\t\t}\n\n\t\treturn result;\n\t} );\n\n\t// If displaying initial suggestions just return plain results.\n\tif ( isInitialSuggestions ) {\n\t\treturn results;\n\t}\n\n\t// Here we append a faux suggestion to represent a \"CREATE\" option. This\n\t// is detected in the rendering of the search results and handled as a\n\t// special case. This is currently necessary because the suggestions\n\t// dropdown will only appear if there are valid suggestions and\n\t// therefore unless the create option is a suggestion it will not\n\t// display in scenarios where there are no results returned from the\n\t// API. In addition promoting CREATE to a first class suggestion affords\n\t// the a11y benefits afforded by `URLInput` to all suggestions (eg:\n\t// keyboard handling, ARIA roles...etc).\n\t//\n\t// Note also that the value of the `title` and `url` properties must correspond\n\t// to the text value of the `<input>`. This is because `title` is used\n\t// when creating the suggestion. Similarly `url` is used when using keyboard to select\n\t// the suggestion (the <form> `onSubmit` handler falls-back to `url`).\n\treturn isURLLike( val ) || ! withCreateSuggestion\n\t\t? results\n\t\t: results.concat( {\n\t\t\t\t// the `id` prop is intentionally ommitted here because it\n\t\t\t\t// is never exposed as part of the component's public API.\n\t\t\t\t// see: https://github.com/WordPress/gutenberg/pull/19775#discussion_r378931316.\n\t\t\t\ttitle: val, // Must match the existing `<input>`s text value.\n\t\t\t\turl: val, // Must match the existing `<input>`s text value.\n\t\t\t\ttype: CREATE_TYPE,\n\t\t  } );\n};\n\nexport default function useSearchHandler(\n\tsuggestionsQuery,\n\tallowDirectEntry,\n\twithCreateSuggestion,\n\twithURLSuggestion\n) {\n\tconst { fetchSearchSuggestions, pageOnFront } = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\n\t\treturn {\n\t\t\tpageOnFront: getSettings().pageOnFront,\n\t\t\tfetchSearchSuggestions:\n\t\t\t\tgetSettings().__experimentalFetchLinkSuggestions,\n\t\t};\n\t}, [] );\n\n\tconst directEntryHandler = allowDirectEntry\n\t\t? handleDirectEntry\n\t\t: handleNoop;\n\n\treturn useCallback(\n\t\t( val, { isInitialSuggestions } ) => {\n\t\t\treturn isURLLike( val )\n\t\t\t\t? directEntryHandler( val, { isInitialSuggestions } )\n\t\t\t\t: handleEntitySearch(\n\t\t\t\t\t\tval,\n\t\t\t\t\t\t{ ...suggestionsQuery, isInitialSuggestions },\n\t\t\t\t\t\tfetchSearchSuggestions,\n\t\t\t\t\t\twithCreateSuggestion,\n\t\t\t\t\t\twithURLSuggestion,\n\t\t\t\t\t\tpageOnFront\n\t\t\t\t  );\n\t\t},\n\t\t[\n\t\t\tdirectEntryHandler,\n\t\t\tfetchSearchSuggestions,\n\t\t\tpageOnFront,\n\t\t\tsuggestionsQuery,\n\t\t\twithCreateSuggestion,\n\t\t\twithURLSuggestion,\n\t\t]\n\t);\n}\n"]}