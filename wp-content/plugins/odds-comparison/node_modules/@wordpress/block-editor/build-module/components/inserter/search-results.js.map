{"version":3,"sources":["@wordpress/block-editor/src/components/inserter/search-results.js"],"names":["useMemo","useEffect","__","_n","sprintf","VisuallyHidden","useDebounce","useAsyncList","speak","useSelect","BlockTypesList","BlockPatternsList","__unstableInserterMenuExtension","InserterPanel","InserterNoResults","useInsertionPoint","usePatternsState","useBlockTypesState","searchBlockItems","searchItems","InserterListbox","orderBy","orderInserterBlockItems","store","blockEditorStore","INITIAL_INSERTER_RESULTS","EMPTY_ARRAY","InserterSearchResults","filterValue","onSelect","onHover","rootClientId","clientId","isAppender","__experimentalInsertionIndex","maxBlockPatterns","maxBlockTypes","showBlockDirectory","isDraggable","shouldFocusBlock","prioritizePatterns","selectBlockOnInsert","debouncedSpeak","prioritizedBlocks","select","blockListSettings","getBlockListSettings","prioritizedInserterBlocks","destinationRootClientId","onInsertBlocks","insertionIndex","blockTypes","blockTypeCategories","blockTypeCollections","onSelectBlockType","patterns","onSelectBlockPattern","filteredBlockPatterns","results","undefined","slice","maxBlockTypesToShow","length","filteredBlockTypes","orderedItems","count","resultsFoundMessage","currentShownBlockTypes","step","currentShownPatterns","hasItems","blocksUI","patternsUI","fills"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useMemo, useEffect } from '@wordpress/element';\nimport { __, _n, sprintf } from '@wordpress/i18n';\nimport { VisuallyHidden } from '@wordpress/components';\nimport { useDebounce, useAsyncList } from '@wordpress/compose';\nimport { speak } from '@wordpress/a11y';\nimport { useSelect } from '@wordpress/data';\n\n/**\n * Internal dependencies\n */\nimport BlockTypesList from '../block-types-list';\nimport BlockPatternsList from '../block-patterns-list';\nimport __unstableInserterMenuExtension from '../inserter-menu-extension';\nimport InserterPanel from './panel';\nimport InserterNoResults from './no-results';\nimport useInsertionPoint from './hooks/use-insertion-point';\nimport usePatternsState from './hooks/use-patterns-state';\nimport useBlockTypesState from './hooks/use-block-types-state';\nimport { searchBlockItems, searchItems } from './search-items';\nimport InserterListbox from '../inserter-listbox';\nimport { orderBy } from '../../utils/sorting';\nimport { orderInserterBlockItems } from '../../utils/order-inserter-block-items';\nimport { store as blockEditorStore } from '../../store';\n\nconst INITIAL_INSERTER_RESULTS = 9;\n/**\n * Shared reference to an empty array for cases where it is important to avoid\n * returning a new array reference on every invocation and rerendering the component.\n *\n * @type {Array}\n */\nconst EMPTY_ARRAY = [];\n\nfunction InserterSearchResults( {\n\tfilterValue,\n\tonSelect,\n\tonHover,\n\trootClientId,\n\tclientId,\n\tisAppender,\n\t__experimentalInsertionIndex,\n\tmaxBlockPatterns,\n\tmaxBlockTypes,\n\tshowBlockDirectory = false,\n\tisDraggable = true,\n\tshouldFocusBlock = true,\n\tprioritizePatterns,\n\tselectBlockOnInsert,\n} ) {\n\tconst debouncedSpeak = useDebounce( speak, 500 );\n\n\tconst { prioritizedBlocks } = useSelect(\n\t\t( select ) => {\n\t\t\tconst blockListSettings =\n\t\t\t\tselect( blockEditorStore ).getBlockListSettings( rootClientId );\n\n\t\t\treturn {\n\t\t\t\tprioritizedBlocks:\n\t\t\t\t\tblockListSettings?.prioritizedInserterBlocks || EMPTY_ARRAY,\n\t\t\t};\n\t\t},\n\t\t[ rootClientId ]\n\t);\n\n\tconst [ destinationRootClientId, onInsertBlocks ] = useInsertionPoint( {\n\t\tonSelect,\n\t\trootClientId,\n\t\tclientId,\n\t\tisAppender,\n\t\tinsertionIndex: __experimentalInsertionIndex,\n\t\tshouldFocusBlock,\n\t\tselectBlockOnInsert,\n\t} );\n\tconst [\n\t\tblockTypes,\n\t\tblockTypeCategories,\n\t\tblockTypeCollections,\n\t\tonSelectBlockType,\n\t] = useBlockTypesState( destinationRootClientId, onInsertBlocks );\n\tconst [ patterns, , onSelectBlockPattern ] = usePatternsState(\n\t\tonInsertBlocks,\n\t\tdestinationRootClientId\n\t);\n\n\tconst filteredBlockPatterns = useMemo( () => {\n\t\tif ( maxBlockPatterns === 0 ) {\n\t\t\treturn [];\n\t\t}\n\t\tconst results = searchItems( patterns, filterValue );\n\t\treturn maxBlockPatterns !== undefined\n\t\t\t? results.slice( 0, maxBlockPatterns )\n\t\t\t: results;\n\t}, [ filterValue, patterns, maxBlockPatterns ] );\n\n\tlet maxBlockTypesToShow = maxBlockTypes;\n\tif ( prioritizePatterns && filteredBlockPatterns.length > 2 ) {\n\t\tmaxBlockTypesToShow = 0;\n\t}\n\n\tconst filteredBlockTypes = useMemo( () => {\n\t\tif ( maxBlockTypesToShow === 0 ) {\n\t\t\treturn [];\n\t\t}\n\n\t\tlet orderedItems = orderBy( blockTypes, 'frecency', 'desc' );\n\n\t\tif ( ! filterValue && prioritizedBlocks.length ) {\n\t\t\torderedItems = orderInserterBlockItems(\n\t\t\t\torderedItems,\n\t\t\t\tprioritizedBlocks\n\t\t\t);\n\t\t}\n\n\t\tconst results = searchBlockItems(\n\t\t\torderedItems,\n\t\t\tblockTypeCategories,\n\t\t\tblockTypeCollections,\n\t\t\tfilterValue\n\t\t);\n\n\t\treturn maxBlockTypesToShow !== undefined\n\t\t\t? results.slice( 0, maxBlockTypesToShow )\n\t\t\t: results;\n\t}, [\n\t\tfilterValue,\n\t\tblockTypes,\n\t\tblockTypeCategories,\n\t\tblockTypeCollections,\n\t\tmaxBlockTypesToShow,\n\t\tprioritizedBlocks,\n\t] );\n\n\t// Announce search results on change.\n\tuseEffect( () => {\n\t\tif ( ! filterValue ) {\n\t\t\treturn;\n\t\t}\n\t\tconst count = filteredBlockTypes.length + filteredBlockPatterns.length;\n\t\tconst resultsFoundMessage = sprintf(\n\t\t\t/* translators: %d: number of results. */\n\t\t\t_n( '%d result found.', '%d results found.', count ),\n\t\t\tcount\n\t\t);\n\t\tdebouncedSpeak( resultsFoundMessage );\n\t}, [\n\t\tfilterValue,\n\t\tdebouncedSpeak,\n\t\tfilteredBlockTypes,\n\t\tfilteredBlockPatterns,\n\t] );\n\n\tconst currentShownBlockTypes = useAsyncList( filteredBlockTypes, {\n\t\tstep: INITIAL_INSERTER_RESULTS,\n\t} );\n\tconst currentShownPatterns = useAsyncList(\n\t\tcurrentShownBlockTypes.length === filteredBlockTypes.length\n\t\t\t? filteredBlockPatterns\n\t\t\t: EMPTY_ARRAY\n\t);\n\n\tconst hasItems =\n\t\tfilteredBlockTypes.length > 0 || filteredBlockPatterns.length > 0;\n\n\tconst blocksUI = !! filteredBlockTypes.length && (\n\t\t<InserterPanel\n\t\t\ttitle={ <VisuallyHidden>{ __( 'Blocks' ) }</VisuallyHidden> }\n\t\t>\n\t\t\t<BlockTypesList\n\t\t\t\titems={ currentShownBlockTypes }\n\t\t\t\tonSelect={ onSelectBlockType }\n\t\t\t\tonHover={ onHover }\n\t\t\t\tlabel={ __( 'Blocks' ) }\n\t\t\t\tisDraggable={ isDraggable }\n\t\t\t/>\n\t\t</InserterPanel>\n\t);\n\n\tconst patternsUI = !! filteredBlockPatterns.length && (\n\t\t<InserterPanel\n\t\t\ttitle={\n\t\t\t\t<VisuallyHidden>{ __( 'Block Patterns' ) }</VisuallyHidden>\n\t\t\t}\n\t\t>\n\t\t\t<div className=\"block-editor-inserter__quick-inserter-patterns\">\n\t\t\t\t<BlockPatternsList\n\t\t\t\t\tshownPatterns={ currentShownPatterns }\n\t\t\t\t\tblockPatterns={ filteredBlockPatterns }\n\t\t\t\t\tonClickPattern={ onSelectBlockPattern }\n\t\t\t\t\tonHover={ onHover }\n\t\t\t\t\tisDraggable={ isDraggable }\n\t\t\t\t/>\n\t\t\t</div>\n\t\t</InserterPanel>\n\t);\n\n\treturn (\n\t\t<InserterListbox>\n\t\t\t{ ! showBlockDirectory && ! hasItems && <InserterNoResults /> }\n\n\t\t\t{ prioritizePatterns ? patternsUI : blocksUI }\n\n\t\t\t{ !! filteredBlockTypes.length &&\n\t\t\t\t!! filteredBlockPatterns.length && (\n\t\t\t\t\t<div className=\"block-editor-inserter__quick-inserter-separator\" />\n\t\t\t\t) }\n\n\t\t\t{ prioritizePatterns ? blocksUI : patternsUI }\n\n\t\t\t{ showBlockDirectory && (\n\t\t\t\t<__unstableInserterMenuExtension.Slot\n\t\t\t\t\tfillProps={ {\n\t\t\t\t\t\tonSelect: onSelectBlockType,\n\t\t\t\t\t\tonHover,\n\t\t\t\t\t\tfilterValue,\n\t\t\t\t\t\thasItems,\n\t\t\t\t\t\trootClientId: destinationRootClientId,\n\t\t\t\t\t} }\n\t\t\t\t>\n\t\t\t\t\t{ ( fills ) => {\n\t\t\t\t\t\tif ( fills.length ) {\n\t\t\t\t\t\t\treturn fills;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif ( ! hasItems ) {\n\t\t\t\t\t\t\treturn <InserterNoResults />;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn null;\n\t\t\t\t\t} }\n\t\t\t\t</__unstableInserterMenuExtension.Slot>\n\t\t\t) }\n\t\t</InserterListbox>\n\t);\n}\n\nexport default InserterSearchResults;\n"]}