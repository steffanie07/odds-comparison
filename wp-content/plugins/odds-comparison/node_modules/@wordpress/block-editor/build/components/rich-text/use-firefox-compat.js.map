{"version":3,"sources":["@wordpress/block-editor/src/components/rich-text/use-firefox-compat.js"],"names":["useFirefoxCompat","props","propsRef","current","isMultiSelecting","blockEditorStore","element","onFocus","parentEditable","parentElement","closest","focus","onKeyDown","event","keyCode","SPACE","value","onChange","preventDefault","addEventListener","removeEventListener"],"mappings":";;;;;;;AAGA;;AACA;;AACA;;AACA;;AACA;;AAKA;;AAZA;AACA;AACA;;AAOA;AACA;AACA;AAGO,SAASA,gBAAT,CAA2BC,KAA3B,EAAmC;AACzC,QAAMC,QAAQ,GAAG,qBAAQD,KAAR,CAAjB;AACAC,EAAAA,QAAQ,CAACC,OAAT,GAAmBF,KAAnB;AAEA,QAAM;AAAEG,IAAAA;AAAF,MAAuB,qBAAWC,YAAX,CAA7B;AACA,SAAO,2BAAgBC,OAAF,IAAe;AACnC,aAASC,OAAT,GAAmB;AAClB,UAAK,CAAEH,gBAAgB,EAAvB,EAA4B;AAC3B;AACA,OAHiB,CAKlB;AACA;AACA;AACA;AACA;;;AACA,YAAMI,cAAc,GAAGF,OAAO,CAACG,aAAR,CAAsBC,OAAtB,CACtB,0BADsB,CAAvB;;AAIA,UAAKF,cAAL,EAAsB;AACrBA,QAAAA,cAAc,CAACG,KAAf;AACA;AACD,KAlBkC,CAoBnC;AACA;AACA;AACA;;;AACA,aAASC,SAAT,CAAoBC,KAApB,EAA4B;AAC3B,UAAKA,KAAK,CAACC,OAAN,KAAkBC,eAAvB,EAA+B;AAC9B;AACA;;AAED,UAAKT,OAAO,CAACI,OAAR,CAAiB,iBAAjB,MAAyC,IAA9C,EAAqD;AACpD;AACA;;AAED,YAAM;AAAEM,QAAAA,KAAF;AAASC,QAAAA;AAAT,UAAsBf,QAAQ,CAACC,OAArC;AACAc,MAAAA,QAAQ,CAAE,sBAAQD,KAAR,EAAe,GAAf,CAAF,CAAR;AACAH,MAAAA,KAAK,CAACK,cAAN;AACA;;AAEDZ,IAAAA,OAAO,CAACa,gBAAR,CAA0B,OAA1B,EAAmCZ,OAAnC;AACAD,IAAAA,OAAO,CAACa,gBAAR,CAA0B,SAA1B,EAAqCP,SAArC;AACA,WAAO,MAAM;AACZN,MAAAA,OAAO,CAACc,mBAAR,CAA6B,OAA7B,EAAsCb,OAAtC;AACAD,MAAAA,OAAO,CAACc,mBAAR,CAA6B,SAA7B,EAAwCR,SAAxC;AACA,KAHD;AAIA,GA5CM,EA4CJ,EA5CI,CAAP;AA6CA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { useSelect } from '@wordpress/data';\nimport { SPACE } from '@wordpress/keycodes';\nimport { insert } from '@wordpress/rich-text';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\n\nexport function useFirefoxCompat( props ) {\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\n\tconst { isMultiSelecting } = useSelect( blockEditorStore );\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onFocus() {\n\t\t\tif ( ! isMultiSelecting() ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// This is a little hack to work around focus issues with nested\n\t\t\t// editable elements in Firefox. For some reason the editable child\n\t\t\t// element sometimes regains focus, while it should not be focusable\n\t\t\t// and focus should remain on the editable parent element.\n\t\t\t// To do: try to find the cause of the shifting focus.\n\t\t\tconst parentEditable = element.parentElement.closest(\n\t\t\t\t'[contenteditable=\"true\"]'\n\t\t\t);\n\n\t\t\tif ( parentEditable ) {\n\t\t\t\tparentEditable.focus();\n\t\t\t}\n\t\t}\n\n\t\t// If a contenteditable element is inside a button/summary element,\n\t\t// it is not possible to type a space in Firefox. Therefore, cancel\n\t\t// the default event and insert a space explicitly.\n\t\t// See: https://bugzilla.mozilla.org/show_bug.cgi?id=1822860\n\t\tfunction onKeyDown( event ) {\n\t\t\tif ( event.keyCode !== SPACE ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( element.closest( 'button, summary' ) === null ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { value, onChange } = propsRef.current;\n\t\t\tonChange( insert( value, ' ' ) );\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\telement.addEventListener( 'focus', onFocus );\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'focus', onFocus );\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"]}