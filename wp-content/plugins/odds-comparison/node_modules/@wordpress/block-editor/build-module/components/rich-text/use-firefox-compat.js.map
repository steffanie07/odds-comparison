{"version":3,"sources":["@wordpress/block-editor/src/components/rich-text/use-firefox-compat.js"],"names":["useRef","useRefEffect","useSelect","SPACE","insert","store","blockEditorStore","useFirefoxCompat","props","propsRef","current","isMultiSelecting","element","onFocus","parentEditable","parentElement","closest","focus","onKeyDown","event","keyCode","value","onChange","preventDefault","addEventListener","removeEventListener"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,MAAT,QAAuB,oBAAvB;AACA,SAASC,YAAT,QAA6B,oBAA7B;AACA,SAASC,SAAT,QAA0B,iBAA1B;AACA,SAASC,KAAT,QAAsB,qBAAtB;AACA,SAASC,MAAT,QAAuB,sBAAvB;AAEA;AACA;AACA;;AACA,SAASC,KAAK,IAAIC,gBAAlB,QAA0C,aAA1C;AAEA,OAAO,SAASC,gBAAT,CAA2BC,KAA3B,EAAmC;AACzC,QAAMC,QAAQ,GAAGT,MAAM,CAAEQ,KAAF,CAAvB;AACAC,EAAAA,QAAQ,CAACC,OAAT,GAAmBF,KAAnB;AAEA,QAAM;AAAEG,IAAAA;AAAF,MAAuBT,SAAS,CAAEI,gBAAF,CAAtC;AACA,SAAOL,YAAY,CAAIW,OAAF,IAAe;AACnC,aAASC,OAAT,GAAmB;AAClB,UAAK,CAAEF,gBAAgB,EAAvB,EAA4B;AAC3B;AACA,OAHiB,CAKlB;AACA;AACA;AACA;AACA;;;AACA,YAAMG,cAAc,GAAGF,OAAO,CAACG,aAAR,CAAsBC,OAAtB,CACtB,0BADsB,CAAvB;;AAIA,UAAKF,cAAL,EAAsB;AACrBA,QAAAA,cAAc,CAACG,KAAf;AACA;AACD,KAlBkC,CAoBnC;AACA;AACA;AACA;;;AACA,aAASC,SAAT,CAAoBC,KAApB,EAA4B;AAC3B,UAAKA,KAAK,CAACC,OAAN,KAAkBjB,KAAvB,EAA+B;AAC9B;AACA;;AAED,UAAKS,OAAO,CAACI,OAAR,CAAiB,iBAAjB,MAAyC,IAA9C,EAAqD;AACpD;AACA;;AAED,YAAM;AAAEK,QAAAA,KAAF;AAASC,QAAAA;AAAT,UAAsBb,QAAQ,CAACC,OAArC;AACAY,MAAAA,QAAQ,CAAElB,MAAM,CAAEiB,KAAF,EAAS,GAAT,CAAR,CAAR;AACAF,MAAAA,KAAK,CAACI,cAAN;AACA;;AAEDX,IAAAA,OAAO,CAACY,gBAAR,CAA0B,OAA1B,EAAmCX,OAAnC;AACAD,IAAAA,OAAO,CAACY,gBAAR,CAA0B,SAA1B,EAAqCN,SAArC;AACA,WAAO,MAAM;AACZN,MAAAA,OAAO,CAACa,mBAAR,CAA6B,OAA7B,EAAsCZ,OAAtC;AACAD,MAAAA,OAAO,CAACa,mBAAR,CAA6B,SAA7B,EAAwCP,SAAxC;AACA,KAHD;AAIA,GA5CkB,EA4ChB,EA5CgB,CAAnB;AA6CA","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useRef } from '@wordpress/element';\nimport { useRefEffect } from '@wordpress/compose';\nimport { useSelect } from '@wordpress/data';\nimport { SPACE } from '@wordpress/keycodes';\nimport { insert } from '@wordpress/rich-text';\n\n/**\n * Internal dependencies\n */\nimport { store as blockEditorStore } from '../../store';\n\nexport function useFirefoxCompat( props ) {\n\tconst propsRef = useRef( props );\n\tpropsRef.current = props;\n\n\tconst { isMultiSelecting } = useSelect( blockEditorStore );\n\treturn useRefEffect( ( element ) => {\n\t\tfunction onFocus() {\n\t\t\tif ( ! isMultiSelecting() ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// This is a little hack to work around focus issues with nested\n\t\t\t// editable elements in Firefox. For some reason the editable child\n\t\t\t// element sometimes regains focus, while it should not be focusable\n\t\t\t// and focus should remain on the editable parent element.\n\t\t\t// To do: try to find the cause of the shifting focus.\n\t\t\tconst parentEditable = element.parentElement.closest(\n\t\t\t\t'[contenteditable=\"true\"]'\n\t\t\t);\n\n\t\t\tif ( parentEditable ) {\n\t\t\t\tparentEditable.focus();\n\t\t\t}\n\t\t}\n\n\t\t// If a contenteditable element is inside a button/summary element,\n\t\t// it is not possible to type a space in Firefox. Therefore, cancel\n\t\t// the default event and insert a space explicitly.\n\t\t// See: https://bugzilla.mozilla.org/show_bug.cgi?id=1822860\n\t\tfunction onKeyDown( event ) {\n\t\t\tif ( event.keyCode !== SPACE ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif ( element.closest( 'button, summary' ) === null ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst { value, onChange } = propsRef.current;\n\t\t\tonChange( insert( value, ' ' ) );\n\t\t\tevent.preventDefault();\n\t\t}\n\n\t\telement.addEventListener( 'focus', onFocus );\n\t\telement.addEventListener( 'keydown', onKeyDown );\n\t\treturn () => {\n\t\t\telement.removeEventListener( 'focus', onFocus );\n\t\t\telement.removeEventListener( 'keydown', onKeyDown );\n\t\t};\n\t}, [] );\n}\n"]}