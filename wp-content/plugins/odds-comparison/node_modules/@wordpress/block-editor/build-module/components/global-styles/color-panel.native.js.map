{"version":3,"sources":["@wordpress/block-editor/src/components/global-styles/color-panel.native.js"],"names":["useSelect","useEffect","useState","useMemo","useCallback","__","useGlobalStyles","store","blockEditorStore","PanelColorGradientSettings","useColorsPerOrigin","useGradientsPerOrigin","getValueFromVariable","setImmutably","ContrastChecker","InspectorControls","useHasColorPanel","useHasTextPanel","useHasBackgroundPanel","ColorPanel","value","inheritedValue","onChange","settings","colors","gradients","globalStyles","detectedBackgroundColor","setDetectedBackgroundColor","detectedTextColor","setDetectedTextColor","baseGlobalStyles","select","getSettings","__experimentalGlobalStylesBaseStyles","color","decodeValue","rawValue","encodeColorValue","colorValue","allColors","flatMap","originColors","colorObject","find","slug","encodeGradientValue","gradientValue","allGradients","originGradients","gradientObject","gradient","showTextPanel","textColor","text","setTextColor","newColor","resetTextColor","undefined","showBackgroundPanel","backgroundColor","background","setBackgroundColor","newValue","setGradient","newGradient","resetBackground","currentGradients","withoutGradientsSupport","Array","isArray","length","items","label","onColorChange","onColorCleared","onGradientChange","filter","Boolean","currentDetectedTextColor","currentDetectedBackgroundColor"],"mappings":"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","sourcesContent":["/**\n * WordPress dependencies\n */\nimport { useSelect } from '@wordpress/data';\nimport { useEffect, useState, useMemo, useCallback } from '@wordpress/element';\nimport { __ } from '@wordpress/i18n';\nimport { useGlobalStyles } from '@wordpress/components';\nimport { store as blockEditorStore } from '@wordpress/block-editor';\n\n/**\n * Internal dependencies\n */\nimport PanelColorGradientSettings from '../colors-gradients/panel-color-gradient-settings';\nimport { useColorsPerOrigin, useGradientsPerOrigin } from './hooks';\nimport { getValueFromVariable } from './utils';\nimport { setImmutably } from '../../utils/object';\nimport ContrastChecker from '../contrast-checker';\nimport InspectorControls from '../inspector-controls';\nimport {\n\tuseHasColorPanel,\n\tuseHasTextPanel,\n\tuseHasBackgroundPanel,\n} from './color-panel.js';\n\nconst ColorPanel = ( {\n\tvalue,\n\tinheritedValue = value,\n\tonChange,\n\tsettings,\n} ) => {\n\tconst colors = useColorsPerOrigin( settings );\n\tconst gradients = useGradientsPerOrigin( settings );\n\tconst globalStyles = useGlobalStyles();\n\n\tconst [ detectedBackgroundColor, setDetectedBackgroundColor ] = useState();\n\tconst [ detectedTextColor, setDetectedTextColor ] = useState();\n\n\tconst { baseGlobalStyles } = useSelect( ( select ) => {\n\t\tconst { getSettings } = select( blockEditorStore );\n\t\treturn {\n\t\t\tbaseGlobalStyles:\n\t\t\t\tgetSettings()?.__experimentalGlobalStylesBaseStyles?.color,\n\t\t};\n\t} );\n\n\tconst decodeValue = ( rawValue ) =>\n\t\tgetValueFromVariable( { settings }, '', rawValue );\n\tconst encodeColorValue = useCallback(\n\t\t( colorValue ) => {\n\t\t\tconst allColors = colors.flatMap(\n\t\t\t\t( { colors: originColors } ) => originColors\n\t\t\t);\n\t\t\tconst colorObject = allColors.find(\n\t\t\t\t( { color } ) => color === colorValue\n\t\t\t);\n\t\t\treturn colorObject\n\t\t\t\t? 'var:preset|color|' + colorObject.slug\n\t\t\t\t: colorValue;\n\t\t},\n\t\t[ colors ]\n\t);\n\tconst encodeGradientValue = useCallback(\n\t\t( gradientValue ) => {\n\t\t\tconst allGradients = gradients.flatMap(\n\t\t\t\t( { gradients: originGradients } ) => originGradients\n\t\t\t);\n\t\t\tconst gradientObject = allGradients.find(\n\t\t\t\t( { gradient } ) => gradient === gradientValue\n\t\t\t);\n\t\t\treturn gradientObject\n\t\t\t\t? 'var:preset|gradient|' + gradientObject.slug\n\t\t\t\t: gradientValue;\n\t\t},\n\t\t[ gradients ]\n\t);\n\n\t// Text Color\n\tconst showTextPanel = useHasTextPanel( settings );\n\tconst textColor = decodeValue( inheritedValue?.color?.text );\n\tconst setTextColor = useCallback(\n\t\t( newColor ) => {\n\t\t\tonChange(\n\t\t\t\tsetImmutably(\n\t\t\t\t\tvalue,\n\t\t\t\t\t[ 'color', 'text' ],\n\t\t\t\t\tencodeColorValue( newColor )\n\t\t\t\t)\n\t\t\t);\n\t\t},\n\t\t[ encodeColorValue, onChange, value ]\n\t);\n\tconst resetTextColor = useCallback(\n\t\t() => setTextColor( undefined ),\n\t\t[ setTextColor ]\n\t);\n\n\t// BackgroundColor\n\tconst showBackgroundPanel = useHasBackgroundPanel( settings );\n\tconst backgroundColor = decodeValue( inheritedValue?.color?.background );\n\tconst gradient = decodeValue( inheritedValue?.color?.gradient );\n\tconst setBackgroundColor = useCallback(\n\t\t( newColor ) => {\n\t\t\tconst newValue = setImmutably(\n\t\t\t\tvalue,\n\t\t\t\t[ 'color', 'background' ],\n\t\t\t\tencodeColorValue( newColor )\n\t\t\t);\n\t\t\tnewValue.color.gradient = undefined;\n\t\t\tonChange( newValue );\n\t\t},\n\t\t[ encodeColorValue, onChange, value ]\n\t);\n\tconst setGradient = useCallback(\n\t\t( newGradient ) => {\n\t\t\tconst newValue = setImmutably(\n\t\t\t\tvalue,\n\t\t\t\t[ 'color', 'gradient' ],\n\t\t\t\tencodeGradientValue( newGradient )\n\t\t\t);\n\t\t\tnewValue.color.background = undefined;\n\t\t\tonChange( newValue );\n\t\t},\n\t\t[ encodeGradientValue, onChange, value ]\n\t);\n\tconst resetBackground = useCallback( () => {\n\t\tconst newValue = setImmutably(\n\t\t\tvalue,\n\t\t\t[ 'color', 'background' ],\n\t\t\tundefined\n\t\t);\n\t\tnewValue.color.gradient = undefined;\n\t\tonChange( newValue );\n\t}, [ onChange, value ] );\n\tconst currentGradients = settings?.color?.gradients;\n\tconst withoutGradientsSupport =\n\t\tArray.isArray( currentGradients ) && currentGradients.length === 0;\n\n\tconst items = useMemo(\n\t\t() =>\n\t\t\t[\n\t\t\t\tshowTextPanel && {\n\t\t\t\t\tlabel: __( 'Text' ),\n\t\t\t\t\tcolorValue: textColor,\n\t\t\t\t\tonColorChange: setTextColor,\n\t\t\t\t\tonColorCleared: resetTextColor,\n\t\t\t\t},\n\t\t\t\tshowBackgroundPanel && {\n\t\t\t\t\tlabel: __( 'Background' ),\n\t\t\t\t\tcolorValue: backgroundColor,\n\t\t\t\t\tonColorChange: setBackgroundColor,\n\t\t\t\t\tonColorCleared: resetBackground,\n\t\t\t\t\tonGradientChange: ! withoutGradientsSupport\n\t\t\t\t\t\t? setGradient\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tgradientValue: gradient,\n\t\t\t\t},\n\t\t\t].filter( Boolean ),\n\t\t[\n\t\t\tbackgroundColor,\n\t\t\tgradient,\n\t\t\tresetBackground,\n\t\t\tresetTextColor,\n\t\t\tsetBackgroundColor,\n\t\t\tsetGradient,\n\t\t\tsetTextColor,\n\t\t\tshowBackgroundPanel,\n\t\t\tshowTextPanel,\n\t\t\ttextColor,\n\t\t\twithoutGradientsSupport,\n\t\t]\n\t);\n\n\tuseEffect( () => {\n\t\t// The following logic is used to determine current text/background colors:\n\t\t// 1. The globalStyles object is queried to determine whether a color has been\n\t\t// set via a block's settings.\n\t\t// 2. If a block-based theme is in use and no globalStyles exist, the theme's\n\t\t// default/base colors are used.\n\t\t// 3. If no globalStyles exist and a theme isn't block-based, there is no way\n\t\t// to determine the default text/background color and the checker won't run.\n\t\tconst currentDetectedTextColor =\n\t\t\tglobalStyles?.color || baseGlobalStyles?.text;\n\t\tconst currentDetectedBackgroundColor =\n\t\t\tglobalStyles?.backgroundColor || baseGlobalStyles?.background;\n\n\t\tsetDetectedTextColor( currentDetectedTextColor );\n\t\tsetDetectedBackgroundColor( currentDetectedBackgroundColor );\n\t}, [ globalStyles, baseGlobalStyles ] );\n\n\treturn (\n\t\t<InspectorControls>\n\t\t\t<PanelColorGradientSettings\n\t\t\t\ttitle={ __( 'Color' ) }\n\t\t\t\tinitialOpen={ false }\n\t\t\t\tsettings={ items }\n\t\t\t>\n\t\t\t\t<ContrastChecker\n\t\t\t\t\tbackgroundColor={ detectedBackgroundColor }\n\t\t\t\t\ttextColor={ detectedTextColor }\n\t\t\t\t/>\n\t\t\t</PanelColorGradientSettings>\n\t\t</InspectorControls>\n\t);\n};\n\nexport { useHasColorPanel };\nexport default ColorPanel;\n"]}